<div class="p-6 bg-gray-50 min-h-full">
  
  <div class="flex justify-between items-end mb-8">
    <div>
      <h2 class="text-3xl font-bold text-gray-800 flex items-center">
        <i class="fas fa-receipt mr-3 text-pink-600"></i> Mis Gastos
      </h2>
      <p class="text-gray-500 mt-1">Gestiona tus reportes, recibos y aprobaciones.</p>
    </div>
    
    <div class="flex gap-3">
        <button (click)="fileInput.click()" class="bg-white border border-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-50 shadow-sm font-medium transition flex items-center">
            <i class="fas fa-camera mr-2"></i> Escanear Recibo
            <input #fileInput type="file" class="hidden" (change)="onFileSelected($event)" accept="image/*,.pdf">
        </button>
        <button (click)="openCreateModal()" class="bg-pink-600 text-white px-5 py-2 rounded-lg hover:bg-pink-700 shadow-md font-medium transition flex items-center">
            <i class="fas fa-plus mr-2"></i> Crear Gasto
        </button>
    </div>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
    <div class="bg-white p-5 rounded-xl shadow border-l-4 border-gray-400">
      <p class="text-gray-500 text-sm font-medium uppercase">Por Enviar</p>
      <p class="text-2xl font-bold text-gray-800 mt-1">{{ stats().to_submit | currency:'USD' }}</p>
      <p class="text-xs text-gray-400 mt-1">Borradores en mi bandeja</p>
    </div>
    <div class="bg-white p-5 rounded-xl shadow border-l-4 border-blue-500">
      <p class="text-gray-500 text-sm font-medium uppercase">Por Aprobar</p>
      <p class="text-2xl font-bold text-gray-800 mt-1">{{ stats().to_approve | currency:'USD' }}</p>
      <p class="text-xs text-gray-400 mt-1">Esperando validación</p>
    </div>
    <div class="bg-white p-5 rounded-xl shadow border-l-4 border-purple-500">
      <p class="text-gray-500 text-sm font-medium uppercase">Por Pagar</p>
      <p class="text-2xl font-bold text-gray-800 mt-1">{{ stats().to_pay | currency:'USD' }}</p>
      <p class="text-xs text-gray-400 mt-1">Reembolsos pendientes</p>
    </div>
  </div>

  <div class="bg-white rounded-xl shadow-lg overflow-hidden">
    <div class="border-b border-gray-200 px-6 py-4 flex justify-between items-center bg-gray-50">
      <h3 class="font-semibold text-gray-700">Listado de Gastos</h3>
      <div class="flex gap-2">
        <select class="text-sm border-gray-300 rounded-md focus:ring-pink-500 focus:border-pink-500 bg-white">
            <option>Todos los Estados</option>
            <option>Borrador</option>
            <option>Aprobado</option>
        </select>
      </div>
    </div>
    
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-100">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fecha</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Descripción</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Categoría</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cliente (Refact.)</th>
            <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Total</th>
            <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th>
            <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Adjunto</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-200">
          @for (expense of expenses(); track expense.id) {
            <tr class="hover:bg-gray-50 transition duration-150">
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ expense.date | date:'shortDate' }}</td>
              <td class="px-6 py-4 text-sm font-medium text-gray-900">
                {{ expense.description }}
                <div class="text-xs text-gray-400">{{ expense.accounting_account }}</div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                <span class="px-2 py-1 bg-gray-100 rounded text-xs">{{ expense.category }}</span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                @if (expense.is_billable) {
                    <span class="text-indigo-600 font-medium"><i class="fas fa-check-circle mr-1"></i> {{ expense.customer_name }}</span>
                } @else {
                    <span class="text-gray-400">-</span>
                }
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-right text-gray-900">
                {{ expense.total_amount | currency:expense.currency }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-center">
                <span [class]="getStatusColor(expense.status) + ' px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full'">
                  {{ expense.status }}
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-center text-gray-400">
                @if (expense.receipt_url) {
                    <i class="fas fa-paperclip text-blue-500 cursor-pointer hover:text-blue-700"></i>
                }
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  </div>
</div>

<div *ngIf="isModalOpen" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center backdrop-blur-sm transition-all">
    <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg p-6 transform scale-100">
        <h3 class="text-xl font-bold mb-4 text-gray-800">Registrar Nuevo Gasto</h3>
        
        <div class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700">Descripción</label>
                <input [(ngModel)]="newExpense.description" type="text" class="mt-1 w-full border border-gray-300 rounded-md p-2 focus:ring-pink-500 focus:border-pink-500" placeholder="Ej: Comida con cliente">
            </div>
            
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700">Categoría</label>
                    <select [(ngModel)]="newExpense.category" class="mt-1 w-full border border-gray-300 rounded-md p-2">
                        <option>Viajes</option>
                        <option>Comidas</option>
                        <option>Oficina</option>
                        <option>Transporte</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Fecha</label>
                    <input [(ngModel)]="newExpense.date" type="date" class="mt-1 w-full border border-gray-300 rounded-md p-2">
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700">Monto Total</label>
                    <div class="relative mt-1 rounded-md shadow-sm">
                        <input [(ngModel)]="newExpense.total_amount" type="number" class="block w-full rounded-md border-gray-300 p-2 pr-12 focus:border-pink-500 focus:ring-pink-500" placeholder="0.00">
                        <div class="absolute inset-y-0 right-0 flex items-center pr-3">
                            <span class="text-gray-500 sm:text-sm">USD</span>
                        </div>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Impuestos</label>
                    <input [(ngModel)]="newExpense.tax_amount" type="number" class="mt-1 w-full border border-gray-300 rounded-md p-2" placeholder="0.00">
                </div>
            </div>

            <div class="bg-gray-50 p-3 rounded-lg border border-gray-200">
                <div class="flex items-center mb-2">
                    <input [(ngModel)]="newExpense.is_billable" id="billable" type="checkbox" class="h-4 w-4 text-pink-600 focus:ring-pink-500 border-gray-300 rounded">
                    <label for="billable" class="ml-2 block text-sm text-gray-900">Refacturar a Cliente (Ventas)</label>
                </div>
                @if (newExpense.is_billable) {
                    <input [(ngModel)]="newExpense.customer_name" type="text" placeholder="Nombre del Cliente" class="w-full text-sm border-gray-300 rounded-md p-1.5">
                }
            </div>
        </div>

        <div class="mt-6 flex justify-end space-x-3">
            <button (click)="closeModal()" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200">Cancelar</button>
            <button (click)="saveExpense()" class="px-4 py-2 bg-pink-600 text-white rounded-lg hover:bg-pink-700 font-medium">Guardar Gasto</button>
        </div>
    </div>
</div>
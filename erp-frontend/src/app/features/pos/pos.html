<div class="pos-layout">
  
  <div class="catalog-section">
    <header class="pos-header">
      <h2>ðŸ›’ Punto de Venta</h2>
      <div class="search-bar">
        <input #searchInput type="text" 
               placeholder="[F1] Buscar producto..." 
               [ngModel]="searchTerm()" 
               (ngModelChange)="searchTerm.set($event)">
      </div>
      <button (click)="logout()" class="btn-logout">Salir</button>
    </header>

    <div class="products-grid">
      @for (product of filteredProducts(); track product.id) {
        <div class="product-card" 
             (click)="cartService.addToCart(product)" 
             [class.no-stock]="product.stock <= 0">
          <div class="prod-name">{{ product.name }}</div>
          <div class="prod-sku">{{ product.sku }}</div>
          <div class="prod-price">{{ product.price | currency:'USD' }}</div>
          <div class="prod-stock">Stock: {{ product.stock }}</div>
        </div>
      } @empty {
        <div class="empty-msg">
          <p>No se encontraron productos.</p>
          <small>Presiona F1 para buscar</small>
        </div>
      }
    </div>

    <div class="shortcuts-bar">
      <div class="key"><span class="k">F1</span> Buscar</div>
      <div class="key"><span class="k">F5</span> Cobrar</div>
      <div class="key"><span class="k">ESC</span> Limpiar/Salir</div>
    </div>
  </div>

  <div class="ticket-section">
    <div class="ticket-header">
      <h3>Orden Actual</h3>
      <button (click)="cartService.clear()" class="btn-clear">Limpiar</button>
    </div>

    <div class="ticket-items">
      @for (item of cartService.items(); track item.product.id) {
        <div class="ticket-item">
          <div class="item-info">
            <span class="name">{{ item.product.name }}</span>
            <span class="price">{{ item.product.price | currency:'USD' }} x {{ item.quantity }}</span>
          </div>
          <div class="item-actions">
            <button (click)="cartService.updateQuantity(item.product.id, item.quantity - 1)">-</button>
            <span class="qty">{{ item.quantity }}</span>
            <button (click)="cartService.addToCart(item.product)">+</button>
          </div>
          <div class="item-total">
            {{ (item.product.price * item.quantity) | currency:'USD' }}
          </div>
        </div>
      } @empty {
        <div class="empty-cart">
          <p>El carrito estÃ¡ vacÃ­o</p>
          <p>Seleccione productos del catÃ¡logo</p>
        </div>
      }
    </div>

    <div class="ticket-footer">
      <div class="total-row">
        <span>Total a Pagar:</span>
        <span class="total-amount">{{ cartService.total() | currency:'USD' }}</span>
      </div>
      
      <div class="customer-input" [formGroup]="paymentForm">
        <label style="color: white; font-size: 0.8rem; display: block; margin-bottom: 4px;">Cliente (RIF/CÃ©dula)</label>
        
        <input list="customersList" 
               formControlName="customer_tax_id" 
               placeholder="Buscar Cliente..."
               class="customer-select">
               
        <datalist id="customersList">
          @for (cust of customers(); track cust.id) {
            <option [value]="cust.tax_id">{{ cust.name }} ({{ cust.tax_id }})</option>
          }
        </datalist>
      </div>

      <button class="btn-checkout" 
              (click)="initiateCheckout()" 
              [disabled]="cartService.items().length === 0 || isProcessing">
        <span class="key-hint">[F5]</span> COBRAR
      </button>
    </div>
  </div>

  @if (showPaymentModal) {
    <div class="modal-overlay">
      <div class="modal-content">
        <h3>Completar Pago</h3>
        
        <div class="total-display">
            {{ cartService.total() | currency:'USD' }}
        </div>

        <div class="modal-actions">
          <button type="button" class="btn-cancel" (click)="cancelCheckout()">
            <span class="key-hint">[ESC]</span> Cancelar
          </button>
          <button type="button" class="btn-confirm" (click)="confirmPayment()" [disabled]="isProcessing">
            <span class="key-hint">[F5]</span> CONFIRMAR E IMPRIMIR
          </button>
        </div>
      </div>
    </div>
  }
</div>
<form [formGroup]="form" (ngSubmit)="onSubmit()" class="flex flex-col h-full bg-white font-sans">
  
  <div class="flex-1 overflow-y-auto px-1 py-2 space-y-8">
    
    <div class="space-y-4">
      <div class="flex items-center gap-2 mb-2">
        <div class="h-8 w-8 rounded-full bg-indigo-50 flex items-center justify-center text-indigo-600">
          <i class="fas fa-tag text-sm"></i>
        </div>
        <h3 class="text-sm font-bold text-slate-800 uppercase tracking-wide">Datos Principales</h3>
      </div>

      <div>
        <label class="block text-xs font-semibold text-slate-500 uppercase tracking-wider mb-1.5 ml-1">
          Nombre del Producto <span class="text-red-500">*</span>
        </label>
        <input formControlName="name" type="text" 
               class="w-full rounded-xl border-slate-200 bg-slate-50 p-3 text-sm font-medium text-slate-900 placeholder:text-slate-400 focus:border-indigo-500 focus:bg-white focus:ring-4 focus:ring-indigo-500/10 transition-all"
               [class.border-red-300]="form.get('name')?.invalid && form.get('name')?.touched"
               placeholder="Ej. Queso Parmesano">
        
        @if (form.get('name')?.invalid && form.get('name')?.touched) {
          <p class="mt-1 ml-1 text-xs font-medium text-red-500">Nombre requerido.</p>
        }
      </div>

      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-xs font-semibold text-slate-500 uppercase tracking-wider mb-1.5 ml-1">
            SKU / Código <span class="text-red-500">*</span>
          </label>
          <input formControlName="sku" type="text" 
                 class="w-full rounded-xl border-slate-200 bg-slate-50 p-3 text-sm font-mono font-medium text-slate-700 uppercase focus:border-indigo-500 focus:bg-white focus:ring-4 focus:ring-indigo-500/10 transition-all disabled:opacity-60 disabled:bg-slate-100"
                 placeholder="QSO-001">
          @if (form.get('sku')?.hasError('duplicate')) {
             <p class="mt-1 ml-1 text-xs font-medium text-red-500">Este SKU ya existe.</p>
          }
        </div>
        
        <div>
          <label class="block text-xs font-semibold text-slate-500 uppercase tracking-wider mb-1.5 ml-1">
            Categoría
          </label>
          <input formControlName="category" type="text" 
                 class="w-full rounded-xl border-slate-200 bg-slate-50 p-3 text-sm font-medium text-slate-700 focus:border-indigo-500 focus:bg-white focus:ring-4 focus:ring-indigo-500/10 transition-all"
                 placeholder="Lácteos">
        </div>
      </div>
    </div>

    <div class="h-px bg-slate-100 w-full"></div>

    <div class="space-y-4">
      <div class="flex items-center gap-2 mb-2">
        <div class="h-8 w-8 rounded-full bg-emerald-50 flex items-center justify-center text-emerald-600">
          <i class="fas fa-coins text-sm"></i>
        </div>
        <h3 class="text-sm font-bold text-slate-800 uppercase tracking-wide">Inventario y Precio</h3>
      </div>

      <div>
        <label class="block text-xs font-semibold text-slate-500 uppercase tracking-wider mb-1.5 ml-1">
          Unidad de Medida <span class="text-red-500">*</span>
        </label>
        <div class="relative">
             <select formControlName="measurementUnit" 
                    class="w-full rounded-xl border-slate-200 bg-slate-50 p-3 text-sm font-medium text-slate-700 focus:border-indigo-500 focus:bg-white focus:ring-4 focus:ring-indigo-500/10 transition-all appearance-none cursor-pointer">
              @for (opt of unitOptions; track opt.value) {
                <option [value]="opt.value">{{ opt.label }}</option>
              }
            </select>
            <div class="absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none text-slate-500">
              <i class="fas fa-chevron-down text-xs"></i>
            </div>
        </div>
      </div>

      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-xs font-semibold text-slate-500 uppercase tracking-wider mb-1.5 ml-1">
            Precio Venta ($)
          </label>
          <div class="relative">
            <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-slate-400 pointer-events-none font-bold">$</span>
            <input formControlName="price" type="number" step="0.01"
                   class="w-full rounded-xl border-slate-200 bg-slate-50 pl-8 p-3 text-sm font-bold text-slate-900 focus:border-indigo-500 focus:bg-white focus:ring-4 focus:ring-indigo-500/10 transition-all text-right">
          </div>
        </div>

        <div>
          <label class="block text-xs font-semibold text-slate-500 uppercase tracking-wider mb-1.5 ml-1">
            Stock Disponible
          </label>
          <input formControlName="stock" type="number" step="0.01"
                 class="w-full rounded-xl border-slate-200 bg-slate-50 p-3 text-sm font-bold text-center text-slate-900 focus:border-indigo-500 focus:bg-white focus:ring-4 focus:ring-indigo-500/10 transition-all"
                 placeholder="0.00">
          </div>
      </div>
    </div>

    <div>
      <label class="block text-xs font-semibold text-slate-500 uppercase tracking-wider mb-1.5 ml-1">
        Descripción
      </label>
      <textarea formControlName="description" rows="3" 
                class="w-full rounded-xl border-slate-200 bg-slate-50 p-3 text-sm font-medium text-slate-700 focus:border-indigo-500 focus:bg-white focus:ring-4 focus:ring-indigo-500/10 transition-all resize-none"
                placeholder="Detalles adicionales..."></textarea>
    </div>

  </div>

  <div class="pt-6 border-t border-slate-100 flex justify-end gap-3 mt-auto sticky bottom-0 bg-white z-10">
    <button type="button" (click)="onCancel.emit()" 
            class="px-5 py-2.5 rounded-xl border border-slate-200 text-sm font-semibold text-slate-600 hover:bg-slate-50 transition-colors">
      Cancelar
    </button>
    
    <button type="submit" 
            [disabled]="form.invalid || isLoading()"
            class="px-6 py-2.5 rounded-xl bg-slate-900 text-white text-sm font-semibold shadow-lg shadow-slate-200 hover:bg-slate-800 focus:ring-4 focus:ring-slate-900/20 active:scale-95 transition-all disabled:opacity-50 flex items-center gap-2">
      @if (isLoading()) {
        <i class="fas fa-circle-notch fa-spin"></i>
        <span>Guardando...</span>
      } @else {
        <i class="fas fa-check"></i>
        <span>{{ isEditMode() ? 'Actualizar' : 'Guardar' }}</span>
      }
    </button>
  </div>
</form>